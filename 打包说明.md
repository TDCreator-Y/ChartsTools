# ChartsTools EXE打包说明文档

## 📋 概述

本文档详细说明了如何将ChartsTools项目打包成Windows可执行文件(.exe)，确保在无网络环境的其他Windows电脑上正常运行。

## 🚀 快速开始

### 方法1：使用自动化脚本（推荐）

1. **运行多选项打包脚本**
   ```batch
   build_options.bat
   ```

2. **选择打包方式**
   - 选项1：单文件EXE版本（推荐分发）
   - 选项2：便携版目录（推荐本地使用）

### 方法2：手动打包

1. **激活虚拟环境**
   ```batch
   D:\Python\PythonVenv\chartstools\Scripts\activate
   ```

2. **安装PyInstaller**
   ```batch
   pip install pyinstaller
   ```

3. **执行打包**
   ```batch
   # 单文件版本
   pyinstaller chartstools.spec --clean --noconfirm
   
   # 便携版目录
   pyinstaller chartstools_portable.spec --clean --noconfirm
   ```

## 📁 打包结果

### 单文件EXE版本
- **文件位置**: `dist/ChartsTools.exe`
- **文件大小**: 约100-200MB
- **优点**: 只有一个文件，便于分发
- **缺点**: 启动时间稍长，文件较大

### 便携版目录
- **目录位置**: `dist/ChartsTools_Portable/`
- **主程序**: `dist/ChartsTools_Portable/ChartsTools.exe`
- **优点**: 启动速度快，文件结构清晰
- **缺点**: 需要保持目录完整性

## 🔧 打包配置说明

### chartstools.spec (单文件配置)
```python
# 主要特性：
- 所有文件打包为单个EXE
- 包含所有资源文件和依赖
- 不显示控制台窗口
- 支持Windows版本信息
```

### chartstools_portable.spec (便携版配置)
```python
# 主要特性：
- 创建目录结构
- 启动速度更快
- 文件分离，便于调试
- 同样包含所有资源
```

## 📦 包含的资源文件

打包过程会自动包含以下文件：

### 核心资源
- `resources/js/echarts.min.js` - ECharts图表库
- `resources/styles/` - 主题样式文件
- `resources/templates/` - 模板文件
- `resources/icons/` - 图标文件

### 配置文件
- `config/theme_settings.json` - 主题配置

### 示例数据
- `examples/*.csv` - 示例数据文件
- `examples/*.txt` - 数据说明文件

### 源代码
- `src/` - 完整源代码模块

## 🛠️ 依赖库处理

PyInstaller会自动处理以下依赖：

### PyQt6相关
- PyQt6 核心库
- PyQt6-WebEngine (网页渲染)
- PyQt6 数据文件

### 数据处理
- pandas (数据处理)
- numpy (数值计算)
- openpyxl (Excel支持)

### 其他依赖
- Pygments (语法高亮)
- Pillow (图像处理)
- jinja2 (模板引擎)

## 🔍 故障排除

### 常见问题

1. **虚拟环境激活失败**
   ```
   错误：无法激活虚拟环境
   解决：检查路径 D:\Python\PythonVenv\chartstools 是否正确
   ```

2. **PyInstaller安装失败**
   ```
   错误：网络连接问题
   解决：使用受信任主机参数或手动下载安装
   ```

3. **打包失败**
   ```
   错误：找不到模块
   解决：检查hiddenimports列表，添加缺失模块
   ```

4. **运行时错误**
   ```
   错误：资源文件未找到
   解决：检查datas配置，确保资源文件路径正确
   ```

### 调试方法

1. **启用控制台模式**
   ```python
   # 在spec文件中设置
   console=True
   ```

2. **检查依赖**
   ```batch
   # 分析导入依赖
   pyinstaller --collect-all PyQt6 main.py
   ```

3. **详细日志**
   ```batch
   # 显示详细构建信息
   pyinstaller chartstools.spec --log-level DEBUG
   ```

## 📋 部署清单

### 分发前检查
- [ ] 程序正常启动
- [ ] 界面显示正确
- [ ] 导入CSV/Excel功能正常
- [ ] 图表渲染正确
- [ ] 主题切换正常
- [ ] 配置面板功能正常

### 目标环境测试
- [ ] Windows 10 兼容性
- [ ] Windows 11 兼容性
- [ ] 无网络环境运行
- [ ] 不同分辨率适配
- [ ] 中文字符显示正常

## 🚀 优化建议

### 文件大小优化
1. **排除不必要的模块**
   ```python
   excludes=['tkinter', 'matplotlib', 'scipy']
   ```

2. **压缩选项**
   ```python
   upx=True  # 启用UPX压缩
   ```

### 启动速度优化
1. **使用目录模式而非单文件**
2. **预编译Python字节码**
3. **减少动态导入**

## 📄 版本信息

- **当前版本**: v1.2.0
- **Python版本**: 3.8+
- **PyInstaller版本**: 最新稳定版
- **支持系统**: Windows 10/11

## 📞 技术支持

如遇到打包问题，可以：

1. 查看详细错误日志
2. 检查依赖版本兼容性
3. 在项目GitHub页面提交Issue
4. 参考PyInstaller官方文档

---

**注意**: 请确保在有网络连接的环境下进行首次打包，后续可以离线使用打包好的程序。 