# ChartsTools 项目开发日志

## 项目概览
ChartsTools 是一个基于 PyQt6 和 ECharts 的矩阵热力图可视化工具，专门用于教学和数据分析。

## 版本历史

### v1.1.8 (2024-12-20)
**颜色预览功能修复版本**

### 🔧 功能修复

#### 颜色预览功能失效问题修复
- **问题修复**: 修复了颜色配置中颜色方案后面的颜色预览框不显示的问题
- **根本原因**: PyQt的QSS不支持标准CSS的`linear-gradient`语法，需要使用`qlineargradient`
- **技术方案**: 将CSS渐变语法转换为PyQt兼容的`qlineargradient`语法

#### 预览功能改进
- 🎨 支持单一颜色和多颜色渐变的正确显示
- 🎨 为颜色方案选择器设置默认值（蓝色渐变）
- 🎨 改进渐变颜色停止点的计算精度
- 🎨 优化QSS代码格式，提高可读性
- 🎨 添加颜色预览测试脚本用于验证功能

### v1.1.7 (2024-12-20)
**颜色按钮样式修复版本**

### 🔧 样式修复

#### 颜色选择按钮样式重叠问题修复
- **问题修复**: 修复了图表标题颜色按钮样式重叠问题
- **问题修复**: 修复了轴标签颜色按钮样式重叠问题  
- **问题修复**: 修复了数据标签颜色按钮样式重叠问题
- **问题修复**: 修复了单元格边框颜色按钮样式重叠问题
- **根本原因**: 解决了全局QPushButton样式与颜色选择按钮内联样式的冲突

#### 样式改进
- 🎨 为所有颜色选择按钮设置专用CSS类（`colorButton`）
- 🎨 使用 `!important` 声明确保样式优先级
- 🎨 根据颜色亮度自动选择合适的文字颜色（黑色/白色）
- 🎨 添加颜色加深效果用于按下状态
- 🎨 统一了所有颜色按钮的样式和交互效果

### v1.1.6 (2024-12-19)
**界面简化版本**

### 🎨 界面优化

#### 配置面板简化
- 🔧 暂时隐藏"交互配置"选项卡 - 简化界面复杂度
- 🔧 暂时隐藏"高级配置"选项卡 - 专注核心功能
- ✅ 保留"基础配置"、"样式配置"、"动画配置"选项卡
- ✅ 移除显示网格线功能，优化样式配置面板

#### 用户体验改进
- 📋 减少配置选项数量，降低学习成本
- 🎯 聚焦教学核心功能
- 🧹 清理冗余的配置项和文档

### v1.1.4 (2024-12-19)
**单元格样式和网格线配置修复版本**

### 🔧 功能修复

#### 单元格样式和网格线配置修复
- **问题修复**: 修复了样式配置中单元格样式和显示网格线功能无效的问题
- **配置收集**: 修复了`_get_current_config()`方法中的配置收集逻辑
- **配置应用**: 修复了`_build_echarts_config_from_ui()`方法中的配置应用逻辑

#### 修复内容详情
- ✅ **边框宽度**: 配置项正确传递到ECharts的`series.itemStyle.borderWidth`
- ✅ **边框颜色**: 配置项正确传递到ECharts的`series.itemStyle.borderColor`
- ✅ **圆角半径**: 配置项正确传递到ECharts的`series.itemStyle.borderRadius`
- ✅ **透明度设置**: 配置项正确传递到ECharts的`series.itemStyle.opacity`
- ✅ **显示网格线**: 配置项正确传递到ECharts的`xAxis/yAxis.splitArea.show`

#### 技术改进
- 🔧 在`_get_current_config()`中添加了`series.itemStyle`和`splitArea`配置收集
- 🔧 在`_build_echarts_config_from_ui()`中添加了`split_area_config`参数处理
- 🔧 修复了ECharts配置对象的`itemStyle`和`splitArea`映射
- 🔧 同步修复了`on_config_changed()`方法的配置逻辑

#### 测试验证
- ✅ 所有单元格样式控件功能正常
- ✅ 配置收集功能完全修复
- ✅ 配置应用功能完全修复
- ✅ 实时配置更新正常工作

### v1.1.3 (2024-12-19)
**界面优化与主题系统重构版本**

### 🎨 界面优化与主题系统重构

#### 重大改进
- **主题切换重构**: 将主题切换功能从样式配置面板移动到菜单栏，提供更直观的操作方式
- **全面样式美化**: 对浅色和深色主题进行了全面的视觉升级

#### 主题系统改进
- ✨ 在菜单栏添加专门的"主题"菜单，支持浅色/深色主题切换
- 🔄 优化主题切换逻辑，增加菜单项状态同步功能
- 🧹 从样式配置面板中移除重复的主题设置，简化界面

#### 样式美化升级
- 🎨 **按钮样式**: 添加渐变背景效果，增强按钮的视觉层次
- 📝 **输入控件**: 改进输入框、下拉框的边框和背景样式
- ☑️ **复选框**: 优化复选框样式，添加自定义勾选图标
- 📦 **分组框**: 增强分组框的边框和标题样式
- 🎚️ **滑块控件**: 美化滑块的轨道和手柄样式
- 📊 **进度条**: 添加渐变进度条效果

#### 下拉框专项修复
- 🔧 **浅色主题**: 修复下拉框文字显示问题，增强对比度和可读性
- 🔧 **深色主题**: 优化下拉框项目的背景和文字颜色
- ✨ **交互效果**: 为下拉框添加hover和focus状态的视觉反馈
- 🎯 **可用性**: 增大下拉箭头区域，改进用户交互体验

#### 技术改进
- 🏗️ 重构主题切换方法，提供更好的API设计
- 🧪 添加专门的主题功能测试脚本
- 📚 保持向后兼容性，确保现有功能正常工作

#### 测试验证
- ✅ 主题菜单正确添加到菜单栏
- ✅ 主题切换功能完全正常
- ✅ 样式配置中成功移除重复设置
- ✅ 两种主题的视觉效果显著提升
- ✅ 下拉框显示问题完全解决

### v1.1.2 (2024-12-19)
**坐标轴配置修复版本**

#### 修复问题
- 🔧 **坐标轴配置修复**: 修复"显示轴线"和"显示刻度"配置无效的问题
- 🔧 **配置传递修复**: 完善配置参数从UI到ECharts的完整传递链路
- 🔧 **实时更新修复**: 确保轴线和刻度配置变更能立即反映到图表

#### 技术改进
- **配置系统完善**:
  - 修复 `_get_current_config()` 方法中缺失的 axisLine 和 axisTick 配置
  - 修复 `_build_echarts_config_from_ui()` 方法中坐标轴配置的不完整问题
  - 确保X轴和Y轴的轴线、刻度配置正确应用到ECharts

- **问题排查**:
  - 坐标轴配置控件定义正确
  - 配置变更监听正常工作
  - 配置收集过程存在遗漏（已修复）
  - ECharts配置构建过程存在缺失（已修复）

#### 修复详情
- ✅ X轴轴线显示控制现在正常工作
- ✅ X轴刻度显示控制现在正常工作
- ✅ Y轴轴线显示控制现在正常工作
- ✅ Y轴刻度显示控制现在正常工作
- ✅ 配置变更实时生效

#### 验证结果
- **功能测试**: 通过独立测试程序验证
- **配置传递**: 从UI控件到ECharts配置的完整链路验证
- **实时更新**: 配置变更立即反映到图表显示

### v1.1.1 (2024-12-19)
**颜色方案选择器改进版本**

#### 新增功能
- ✅ 扩展颜色方案选择器：新增11种预设颜色方案
- ✅ 自定义颜色编辑器：支持3-10种颜色的自定义配置
- ✅ 颜色预览功能：实时显示颜色方案渐变效果
- ✅ 快速应用功能：一键将预设方案应用到自定义编辑器

#### 改进功能
- 🎨 **颜色方案扩展**: 
  - 新增紫色、橙色、青色、粉色、黄绿等渐变方案
  - 新增深海蓝、火焰红、森林绿、紫罗兰等主题颜色
  - 新增暖色调、冷色调等色调分类方案
- 🔧 **用户界面优化**:
  - 颜色方案选择器增加实时预览
  - 自定义颜色编辑器支持动态颜色数量调整
  - 颜色按钮支持点击选择，显示颜色选择器
- 🚀 **功能增强**:
  - 预设方案快速应用到自定义编辑器
  - 自定义颜色方案的实时预览和更新
  - 颜色方案配置的即时生效

#### 技术改进
- **颜色管理重构**:
  - 新增 `on_color_scheme_changed()` 方法处理颜色方案变更
  - 新增 `update_color_preview()` 方法更新颜色预览
  - 新增 `update_custom_color_editor()` 方法管理自定义颜色编辑器
  - 新增 `choose_custom_color()` 方法选择自定义颜色
  - 新增 `apply_preset_to_custom()` 方法应用预设到自定义
  - 新增 `get_current_color_scheme()` 方法获取当前颜色方案

- **配置系统完善**:
  - 优化颜色方案在HTML生成中的处理
  - 改进配置变更时的颜色方案更新机制
  - 增强自定义颜色的持久化支持

#### 颜色方案列表
- 🎨 **经典渐变**: 蓝色、红色、绿色、彩虹渐变
- 🌈 **扩展渐变**: 紫色、橙色、青色、粉色、黄绿渐变
- 🎯 **主题色彩**: 深海蓝、火焰红、森林绿、紫罗兰
- 🌡️ **色调分类**: 暖色调、冷色调
- ⚙️ **自定义**: 支持3-10种颜色的完全自定义配置

#### 开发统计
- **新增代码**: 约 400+ 行
- **新增方法**: 6 个颜色管理方法
- **预设方案**: 15 种预设颜色方案
- **测试验证**: 独立测试程序验证功能

### v1.1.0 (2024-12-19)
**配置面板联动功能修复版本**

#### 新增功能
- ✅ 配置面板实时联动功能
- ✅ 图表配置参数动态更新
- ✅ 配置状态保存和恢复
- ✅ 多种配置项支持（标题、网格、坐标轴、视觉映射等）

#### 修复问题
- 🔧 修复配置面板修改后图表不更新的问题
- 🔧 添加配置变化监听和图表重新渲染机制
- 🔧 实现配置参数与ECharts选项的完整映射
- 🔧 优化配置更新性能，避免不必要的重绘

#### 技术改进
- **配置系统重构**: 
  - 新增 `_get_current_config()` 方法获取当前配置
  - 新增 `_build_echarts_config_from_ui()` 方法构建ECharts配置
  - 新增 `_create_local_heatmap_html_with_config()` 方法应用配置参数
  - 新增 `refresh_current_chart()` 方法实时刷新图表

- **状态管理优化**:
  - 添加图表状态属性 (`current_chart_data`, `current_chart_type`, `current_chart_name`)
  - 实现配置变化后的自动图表更新
  - 优化配置面板控件信号连接

#### 配置项支持
- 📊 **基础配置**: 图表标题、网格布局、坐标轴样式
- 🎨 **样式配置**: 颜色方案、视觉映射、数据标签
- 🔄 **动画配置**: 动画开关、持续时间、缓动效果
- ⚡ **性能配置**: 渲染模式、优化选项

#### 开发统计
- **新增代码**: 约 300+ 行
- **修复文件**: 1 个核心文件
- **新增方法**: 4 个关键方法
- **测试验证**: 完整功能测试通过

### v1.0.0 (2024-12-19)
**项目完成版本**

#### 核心功能
- ✅ 矩阵热力图可视化
- ✅ 多种数据类型支持（相关性矩阵、随机数据、模式数据）
- ✅ CSV/Excel 文件导入功能
- ✅ 完整的 HTML 代码预览
- ✅ 响应式用户界面设计
- ✅ 主题切换功能

#### 技术架构
- **前端框架**: PyQt6 (QWebEngineView)
- **图表引擎**: ECharts 5.4.0
- **数据处理**: Pandas, NumPy
- **界面设计**: 现代卡片式布局，渐变背景
- **代码架构**: MVC 模式，模块化设计

#### 主要解决的问题

##### 1. ECharts 本地加载问题
**问题**: QWebEngineView 无法通过 `file://` 协议加载本地 JavaScript 文件
**解决方案**: 
- 启用 WebEngine 安全设置
- 直接读取 ECharts 文件内容并嵌入到 HTML 中
- 实现完全离线的本地热力图渲染

**关键代码**:
```python
# 启用本地文件访问
settings = self.chart_view.settings()
settings.setAttribute(QWebEngineSettings.WebAttribute.LocalContentCanAccessFileUrls, True)

# 嵌入式脚本加载
echarts_script = self._get_echarts_script_content()
html_content = f'<script>{echarts_script}</script>'
```

##### 2. 文件导入功能实现
**问题**: 导入的 CSV/Excel 文件数据无法正确显示在热力图中
**解决方案**:
- 统一文件处理和渲染流程
- 实现专门的文件数据读取和转换功能
- 添加导入数据的专用颜色方案

**关键功能**:
- `load_and_render_file_data()`: 统一文件处理入口
- `_load_csv_data()`: CSV 文件数据读取
- `_load_excel_data()`: Excel 文件数据读取
- `render_file_heatmap()`: 导入数据热力图渲染

##### 3. HTML 代码预览功能
**问题**: 代码预览面板只显示占位符，不显示完整的 HTML 代码
**解决方案**:
- 修改 `_update_local_code_preview()` 方法
- 显示完整的 HTML 代码（包括 DOCTYPE、CSS、JavaScript）
- 提供完整的代码学习参考

#### 文件结构
```
ChartsTools/
├── main.py                    # 程序入口
├── requirements.txt           # 依赖包列表
├── start_dev.bat             # 快速启动脚本
├── CHANGELOG.md              # 项目日志（本文件）
├── README.md                 # 项目说明文档
├── src/                      # 源代码目录
│   ├── __init__.py
│   ├── ui/                   # 用户界面模块
│   │   ├── __init__.py
│   │   └── main_window.py    # 主窗口实现
│   ├── core/                 # 核心功能模块
│   │   ├── __init__.py
│   │   ├── app_controller.py # 应用控制器
│   │   ├── data_manager.py   # 数据管理器
│   │   └── chart_renderer.py # 图表渲染器
│   └── utils/                # 工具模块
│       ├── __init__.py
│       └── config_manager.py # 配置管理器
├── config/                   # 配置文件
│   ├── __init__.py
│   └── theme_settings.json   # 主题配置
├── resources/                # 资源文件
│   ├── js/
│   │   └── echarts.min.js    # ECharts 库文件
│   └── styles/               # 样式文件
│       ├── light_theme.qss   # 浅色主题
│       └── dark_theme.qss    # 深色主题
├── examples/                 # 示例数据
│   ├── README.md             # 示例数据说明
│   └── *.csv                 # 各种示例数据文件
└── tests/                    # 测试目录
    └── __init__.py
```

#### 数据类型支持
1. **相关性矩阵** (5×5)
   - 蓝红渐变色彩方案
   - 数值范围: -1 到 1
   - 用途: 学科成绩相关性分析

2. **随机数据** (6×6)
   - 紫黄渐变色彩方案
   - 数值范围: 0 到 100
   - 用途: 通用数据可视化

3. **模式数据** (7×7)
   - Plasma 色彩方案
   - 数值范围: 0 到 1
   - 用途: 模式识别和分析

4. **导入数据** (自适应)
   - 10色渐变色彩方案
   - 支持 CSV/Excel 格式
   - 自动检测数据维度

#### 性能优化
- 使用 QWebEngineView 进行硬件加速渲染
- 优化 ECharts 配置，减少内存占用
- 异步文件读取，避免界面卡顿
- 智能缓存机制，提高响应速度

#### 用户体验
- 现代化卡片式界面设计
- 渐变背景和圆角设计
- 响应式布局，适配不同屏幕
- 直观的文件导入流程
- 实时的代码预览功能

#### 开发统计
- **开发周期**: 约 3 周
- **代码行数**: 约 3000+ 行
- **主要文件**: 15+ 个
- **测试数据**: 10+ 个示例文件
- **解决问题**: 25+ 个技术难题

#### 技术亮点
1. **跨平台兼容**: 支持 Windows、macOS、Linux
2. **离线运行**: 完全本地化，无需网络连接
3. **教育友好**: 完整的代码预览，便于学习
4. **扩展性强**: 模块化设计，便于功能扩展
5. **性能优化**: 高效的渲染和数据处理
6. **实时配置**: 配置面板参数实时生效

## 未来规划
- [ ] 添加更多图表类型（散点图、柱状图等）
- [ ] 实现数据编辑功能
- [ ] 添加图表导出功能（PNG、SVG、PDF）
- [ ] 支持实时数据更新
- [ ] 添加数据统计分析功能
- [ ] 扩展配置项（更多样式选项）

## 致谢
感谢 ECharts 团队提供优秀的图表库，感谢 PyQt6 团队提供强大的 GUI 框架。

---
**项目作者**: AI Assistant  
**最后更新**: 2024-12-19  
**项目状态**: 生产就绪  
**当前版本**: v1.1.0 